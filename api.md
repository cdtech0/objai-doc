# API文档
## 1. 图片识别
### 1.1 接口描述
用于物体识别，即对输入的图片（可正常解码，且长宽比适宜）对指定的物体（模型支持的物体）进行识别，输出物体数量、所在位置、置信度及面积占比等信息。
### 1.2 请求说明
+ 路径：
```
/api/obj_detect?appid=应用名称&site=区域&camera_id=摄像头标识&far=摄像头朝向&cls=物体类别&score=置信度下限&rate=面积占比下限&scope=围栏区域&ts=照片时间
```
**示例**
```
/api/obj_detect?appid=jasd&camera_id=3055502620884994&far=left&rate=31&save=true&scope=0%2C0%2C1280%2C0%2C1280%2C720%2C0%2C720&score=85&site=91001&ts=202012152341
```
 |参数字段|参数名称|类型|是否必填|备注|
 |--------|--------|:----:|:----:|------|
 |appid|调用应用名称|字符串|否|缺省为odjai|
 |site|监控区域名称|字符串|否|识别结果保存时用于分目录|
 |camera_id|摄像头标识|字符串|否|识别结果保存时用于分目录和关联打洞位置|
 |far|摄像头朝向|字符串|否|left或right,背靠背安装时，增强识别交果|
 |cls|物体类别|字符串|否|缺省为person,可多个，用逗号分隔|
 |score|置信度下限|整数|否|缺省为0,用于物体过滤|
 |rate|面积占比|整数|否|缺省为0,用于电子围栏进行物体占比过滤|
 |scope|围栏区域|多边形|否|缺省无,格式为:x1,y1,x2,y2...,是封闭的多边形,偶数个整数组成|
 |ts|照片时间|字符串|否|缺省为当前时间,格式:yyyyMMddHHmmss|
 |save|是否保存结果|布尔型|否|是，则将识别结果保存到指定的磁盘下|
 注：如果提供围栏，识别结果图片是用绿色画的，识别物体是用红色画的，线粗为1个像素

+ 方法 POST

|图片内容上传方式|上传说明|
|:------:|--------|
|multipart/form-data|字段名称为img,要求为image/jpeg|
|image/jpeg|body中直接保存图片二进制内容|
|application/octet-stream|body中直接保存jpeg图片的内容|
**图片内容上传方式是根据请求的Content-Type中值**

**对于其它格式的图片，可定制**
### 1.3 响应说明
+ 响应结果为json格式
+ Content-Type为application/json

|字段|名称|字段类型|字段说明|
|:------:|:------:|:------:|------|
|code|返回码|整数|0，成功，非0是错误|
|msg|返回消息|字符串|调用成功或错误消息|
|request_id|请求标识|整数|用于查错用的|
|cost|调用花费时间|整数|毫秒数|
|result|响应结果|对象|见下表|

+ result结果的内容

|字段|名称|字段类型|字段说明|
|:------:|:------:|:------:|------|
|class|物体类别|字符串|如：person|
|probability|置信度|浮点数|百分数|
|box|位置区域|整数数组|顶点和底点的坐标，如：[1,2,3,4]|
|scope_rate|面积占比|浮点数|百分数|

+ 结果示例

```
{
    "code":0,
    "msg":"调用成功",
    "request_id":12345,
    "cost": 85,
    "result":[{"class":"person","probability":94.791313,"box":[1008,99,1039,140],"scope_rate":100.0}]
}
```
## 2. 增加“洞”
### 2.1 接口描述
用于调节识别区域，对于一些一直识别错误的域，可采用增加“洞”的方式来排除，此处仅用于暂时不想重新训练模型时，或重新训练后效果不理想的时候用于临时调整。
### 2.2 请求说明
+ 路径：
```
/api/new_exclude?camera_id=摄像头标识&scope=区域范围
```
|字段|名称|字段类型|字段说明|
|:------:|:------:|:------:|------|
|camera_id|摄像头标识|字符串|对应上面的摄像头标识|
|scope|区域范围|字符串|顶点和底点的坐标，格式为:x1,y1,x2,y2|

+ 方法 POST
### 2.2 响应说明
+ 响应结果为json格式
+ Content-Type为application/json

|字段|名称|字段类型|字段说明|
|:------:|:------:|:------:|------|
|code|返回码|整数|0，成功，非0是错误|
|msg|返回消息|字符串|调用成功或错误消息|
|request_id|请求标识|整数|用于查错用的|
|cost|调用花费时间|整数|毫秒数|
|result|响应结果|对象|为null值|

## 2. 查询识别结果
用于在跟踪调试期间查询识别执行结果,是普通的http请求
### 2.2 请求说明
+ 路径： /images
+ 方法：GET
+ 示例
![image](https://github.com/cdtech0/objai-doc/blob/master/images/list.png) 
